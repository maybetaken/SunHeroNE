{
  "manufacturer": "@maybetaken",
  "model": "makeskyblue_mppt",
  "modbus_config": {
    "poll_interval": 1,
    "tasks": [
      { "slave": 1, "cmd": 4, "start": 1, "count": 12 },
      { "slave": 1, "cmd": 4, "start": 26, "count": 1 },
      { "slave": 1, "cmd": 3, "start": 1, "count": 10 }
    ]
  },
  "entities": [
    {
      "key": "sys_ip",
      "type": "sensor_data",
      "name": "WiFi IP Address",
      "source": "json",
      "json_key": "ip",
      "data_type": "ipv4",
      "icon": "mdi:ip-network",
      "entity_category": "diagnostic"
    },
    {
      "key": "sys_ssid",
      "type": "sensor_data",
      "name": "WiFi SSID",
      "source": "json",
      "json_key": "ssid",
      "data_type": "string",
      "icon": "mdi:wifi-settings",
      "entity_category": "diagnostic"
    },
    {
      "key": "sys_rssi",
      "type": "sensor_data",
      "name": "WiFi Signal",
      "source": "json",
      "json_key": "rssi",
      "data_type": "int16",
      "unit": "dBm",
      "device_class": "signal_strength",
      "entity_category": "diagnostic"
    },
    {
      "key": "sys_led",
      "type": "switch",
      "name": "LED",
      "source": "json",
      "json_key": "led",
      "entity_category": "diagnostic"
    },
    {
      "key": "sys_version",
      "type": "sensor_data",
      "name": "Firmware Version",
      "source": "json",
      "json_key": "ver",
      "data_type": "string",
      "icon": "mdi:harddisk",
      "entity_category": "diagnostic"
    },
    {
      "key": "sys_restart",
      "type": "button",
      "name": "Restart Module",
      "source": "json",
      "command_payload": {"cmd": "restart"},
      "entity_category": "diagnostic",
      "device_class": "restart"
    },
    {
      "key": "sys_reset_wifi",
      "type": "button",
      "name": "Reset WiFi",
      "source": "json",
      "command_payload": {"cmd": "reset_wifi"},
      "icon": "mdi:restore-alert",
      "entity_category": "diagnostic"
    },
    {
      "key": "sys_reconfig",
      "type": "button",
      "name": "Reconfigure Module",
      "source": "json",
      "command_payload": {"cmd": "reconfig"},
      "icon": "mdi:restore-alert",
      "entity_category": "diagnostic"
    },
    {
      "key": "mppt_fault",
      "type": "sensor_mapping",
      "name": "MPPT Fault",
      "source": "modbus",
      "slave": 1,
      "register": 1,
      "modbus_func": 4,
      "data_type": "uint16",
      "map": {
        "0": "normal",
        "1": "batt_undervolt",
        "2": "batt_overvolt",
        "4": "over_temp",
        "8": "pv_overvolt",
        "16": "over_current",
        "32": "short_circuit"
      },
      "icon": "mdi:alert"
    },
    {
      "key": "batt_volt",
      "type": "sensor_data",
      "name": "Battery Voltage",
      "source": "modbus",
      "slave": 1,
      "register": 5,
      "modbus_func": 4,
      "data_type": "uint16",
      "scale": 0.1,
      "unit": "V",
      "device_class": "voltage",
      "precision": 1,
      "icon": "mdi:battery"
    },
    {
      "key": "batt_curr",
      "type": "sensor_data",
      "name": "Battery Current",
      "source": "modbus",
      "slave": 1,
      "register": 6,
      "modbus_func": 4,
      "data_type": "int16",
      "scale": 0.1,
      "unit": "A",
      "device_class": "current",
      "precision": 1,
      "icon": "mdi:current-dc"
    },
    {
      "key": "pv_volt",
      "type": "sensor_data",
      "name": "PV Voltage",
      "source": "modbus",
      "slave": 1,
      "register": 7,
      "modbus_func": 4,
      "data_type": "uint16",
      "scale": 0.1,
      "unit": "V",
      "device_class": "voltage",
      "precision": 1,
      "icon": "mdi:solar-power"
    },
    {
      "key": "charge_pow",
      "type": "sensor_data",
      "name": "Charge Power",
      "source": "modbus",
      "slave": 1,
      "register": 8,
      "modbus_func": 4,
      "data_type": "uint16",
      "unit": "W",
      "device_class": "power",
      "precision": 0,
      "icon": "mdi:power"
    },
    {
      "key": "mppt_temp",
      "type": "sensor_data",
      "name": "MPPT Temp",
      "source": "modbus",
      "slave": 1,
      "register": 9,
      "modbus_func": 4,
      "data_type": "int16",
      "scale": 0.1,
      "unit": "Â°C",
      "device_class": "temperature",
      "precision": 1,
      "icon": "mdi:thermometer"
    },
    {
      "key": "total_yield",
      "type": "sensor_data",
      "name": "Total Yield",
      "source": "modbus",
      "slave": 1,
      "register": 10,
      "modbus_func": 4,
      "data_type": "uint16",
      "unit": "kWh",
      "device_class": "energy",
      "state_class": "total_increasing",
      "icon": "mdi:solar-power"
    },
    {
      "key": "mppt_out_curr",
      "type": "sensor_data",
      "name": "MPPT Out Current",
      "source": "modbus",
      "slave": 1,
      "register": 11,
      "modbus_func": 4,
      "data_type": "uint16",
      "scale": 0.1,
      "unit": "A",
      "device_class": "current",
      "precision": 1,
      "icon": "mdi:lightning-bolt"
    },
    {
      "key": "work_status",
      "type": "sensor_mapping",
      "name": "Work Status",
      "source": "modbus",
      "slave": 1,
      "register": 12,
      "modbus_func": 4,
      "data_type": "uint16",
      "map": {
        "0": "shutdown",
        "1": "pre_charge",
        "2": "cc_charge",
        "3": "cv_charge",
        "4": "tracking",
        "5": "bus_cv",
        "6": "float_charge"
      },
      "icon": "mdi:battery-charging"
    },
    {
      "key": "daily_yield",
      "type": "sensor_data",
      "name": "Daily Yield",
      "source": "modbus",
      "slave": 1,
      "register": 26,
      "modbus_func": 4,
      "data_type": "uint16",
      "scale": 0.1,
      "unit": "kWh",
      "device_class": "energy",
      "state_class": "total",
      "precision": 1,
      "icon": "mdi:solar-power"
    },
    {
      "key": "equal_volt",
      "type": "number",
      "name": "Equalization Volt",
      "source": "modbus",
      "slave": 1,
      "register": 1,
      "modbus_func": 3,
      "data_type": "uint16",
      "scale": 0.1,
      "unit": "V",
      "min_value": 0,
      "max_value": 60,
      "step": 0.1,
      "precision": 1,
      "icon": "mdi:solar-panel"
    },
    {
      "key": "float_volt",
      "type": "number",
      "name": "Float Volt",
      "source": "modbus",
      "slave": 1,
      "register": 2,
      "modbus_func": 3,
      "data_type": "uint16",
      "scale": 0.1,
      "unit": "V",
      "min_value": 0,
      "max_value": 60,
      "step": 0.1,
      "precision": 1,
      "icon": "mdi:solar-panel"
    },
    {
      "key": "charge_curr_set",
      "type": "number",
      "name": "Charge Current Set",
      "source": "modbus",
      "slave": 1,
      "register": 4,
      "modbus_func": 3,
      "data_type": "uint16",
      "scale": 0.1,
      "unit": "A",
      "min_value": 0,
      "max_value": 100,
      "step": 0.1,
      "precision": 1,
      "icon": "mdi:current-dc"
    },
    {
      "key": "batt_low_volt",
      "type": "number",
      "name": "Battery Low Volt",
      "source": "modbus",
      "slave": 1,
      "register": 5,
      "modbus_func": 3,
      "data_type": "uint16",
      "scale": 0.1,
      "unit": "V",
      "min_value": 0,
      "max_value": 60,
      "step": 0.1,
      "precision": 1,
      "icon": "mdi:battery-minus"
    },
    {
      "key": "batt_recover_volt",
      "type": "number",
      "name": "Battery Recover Volt",
      "source": "modbus",
      "slave": 1,
      "register": 6,
      "modbus_func": 3,
      "data_type": "uint16",
      "scale": 0.1,
      "unit": "V",
      "min_value": 0,
      "max_value": 60,
      "step": 0.1,
      "precision": 1,
      "icon": "mdi:battery"
    },
    {
      "key": "comm_address",
      "type": "number",
      "name": "Comm Address",
      "source": "modbus",
      "slave": 1,
      "register": 7,
      "modbus_func": 3,
      "data_type": "uint16",
      "min_value": 1,
      "max_value": 256,
      "step": 1,
      "display_precision": 0,
      "icon": "mdi:network"
    },
    {
      "key": "batt_type",
      "type": "select_mapping",
      "name": "Battery Type",
      "source": "modbus",
      "slave": 1,
      "register": 8,
      "modbus_func": 3,
      "data_type": "uint16",
      "map": { "0": "lead_acid", "1": "lithium" },
      "icon": "mdi:battery"
    },
    {
      "key": "batt_num",
      "type": "number",
      "name": "Battery Number",
      "source": "modbus",
      "slave": 1,
      "register": 9,
      "modbus_func": 3,
      "data_type": "uint16",
      "min_value": 1,
      "max_value": 8,
      "step": 1,
      "display_precision": 0,
      "icon": "mdi:battery"
    },
    {
      "key": "cal_volt",
      "type": "number",
      "name": "Calibrate Voltage",
      "source": "modbus",
      "slave": 1,
      "register": 10,
      "modbus_func": 3,
      "data_type": "uint16",
      "scale": 0.1,
      "unit": "V",
      "min_value": 0,
      "max_value": 6553.5,
      "step": 0.1,
      "precision": 1,
      "icon": "mdi:car-battery"
    }
  ]
}
